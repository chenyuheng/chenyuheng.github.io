今天的计网开始讲链路层。链路层提供节点到节点的通信服务，也可能提供可靠传输、错误检测、错误修正等服务。我听完还不是特别清楚链路层与物理层的区别。（既然Wi-Fi是链路层的服务，那么Wi-Fi下面的物理层难道就是空气（空间）了吗？）

一开始提到了链路层在适配器（又叫网卡）的硬件上实现，这个适配器顺便也实现了物理层。在硬件上实现可以高效地做一些特定的运算。

然后是错误检测与修正（EDC）的方法。提了检验和、奇偶校验和循环冗余校验。

网络层和传输层用检验和较多，因为运算量不大。

链路层有用奇偶检验的，基本只检测一位的错误，适用于可靠性较高的媒介，比如缆线。可靠性较高的媒介仍有极小可能出现两位以上的错误，这样的错误可以通过上层网络层或运输层的检验和来剔除。奇偶检验今天新见了一个二维的方法，很容易理解，但直观感觉冗余度有点高。和计组里学过的汉明码的纠错能力感觉差不多，不知道是否等效。（可以留作思考题😂）

还有一个就是循环冗余校验（CRC）了，操作不难，说是除法，实际用异或操作来实现。没讲数学上的证明，不过今天刷Leetcode的题目见识到了一个“异或同一个数两遍等价于无操作”的骚操作，其实和CRC是一个原理，大概也理解了这么做的正确性。但这个貌似也没有纠错功能，只是提供了一个在信道可靠性较低的条件下更加靠谱的错误检验方式。

再接下来提到了共用信道的解决方案。现在一般的缆线都是点对点的传播，没有共用信道的问题。但无线网络和过去常用的总线构造的缆线都需要共用信道。链路层可以提供避免共用信道冲突的多路访问协议（Multiple Access Protocol）。这种多路访问协议主要有三种实现原理：分通路、轮流、随机。

分通路有分频（FDMA）和分时（TDMA）两种，基本原理很容易理解。具体实现上，分频的内容信号与系统里应该讲得比较多，下学期有机会补修下。分时是将时间分成若干个大段，每个大段里有若干小段，每个通路利用固定位置的小段时间来通信。分时的同步问题我不太知道应该怎么实现，这门课也不讨论。

轮流的方法具体有轮询和令牌传递两种。轮询需要一个“主管”机器轮流询问共用信道的其他机器是否需要发送数据，需要则给与许可并等待传递，不需要则询问下一个机器。轮询的缺点是“主管”机器比较累，以及如果“主管”机器坏了，整个信道也不能用了。令牌传递则是在一个环路里传递“令牌”，有令牌的机器才能发送数据，发完后再把令牌传给环路里的下一台机器。这个的缺点是令牌很累，同样的，如果有令牌的机器坏了，整个信道也不能用了。这两个方法实际中都会有自动修复“主管”或者“令牌”坏了的机制。

随机的方法有ALOHA和“载波监听多路访问”（CSMA）。ALOHA是有分时间槽的和纯随机的，都是随心发（分时间槽的需要在时间槽的开始发），如果没有冲突就好，有冲突就随机重发。CSMA则有冲突检出（CSMA/CD）和冲突避免（CSMA/CA）两种方案。冲突检出在发送数据之前以及之中会检测是否有冲突（信道是否空闲），若有则停止发送，另择时机。由于有传播时延，冲突检出方案需要规定最小的数据帧大小，以避免发送时未检测出冲突但到达时存在冲突的现象。冲突避免方案则需要在检出方案的基础上，增加接收方返回确认消息的过程，以避免发送方无法检出冲突但接收方存在冲突的现象。（这种现象叫做隐藏节点问题，会在无线网络中出现）

![隐藏节点问题附图](https://upload.wikimedia.org/wikipedia/commons/2/2b/Wifi_hidden_station_problem.svg)

最后总结的是具体的协议用的什么方案。GSM（貌似是2G数据通信用的系统）用的时分（TDMA），无线电广播和卫星系统用的频分（FDMA）。蓝牙用的轮询（不太理解具体实现）， 光纤分布式数据接口（FDDI） 和令牌环用的令牌传递。以太网用的CSMA/CD，Wi-Fi用的CSMA/CA。

下周会讲局域网的交换机制，期待一下。